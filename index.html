<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lymo</title>

  <link rel="manifest" href="assets/manifest.json">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- ORIGINAL CSS (untouched) -->
  <style>
    :root{
      --bg:#071017;
      --card:#081018;
      --lime-1:#c7ff5a;
      --lime-2:#8ef23b;
      --muted:#9fb1b1;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
      --shadow: 0 12px 40px rgba(2,8,10,0.6);
      --accent: linear-gradient(90deg,var(--lime-1),var(--lime-2));
      --ease:cubic-bezier(.16,.84,.32,1);
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    body{
      margin:0; padding:28px;
      background:
        radial-gradient(500px 300px at 8% 10%, rgba(140,255,120,0.06), transparent 10%),
        radial-gradient(700px 420px at 92% 90%, rgba(140,255,120,0.03), transparent 6%),
        linear-gradient(180deg,#04060a 0%, #071017 100%);
      color:#e6f5e9;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
    }
    header{ display:flex; align-items:center; gap:16px; position:sticky; top:18px; z-index:40;
      backdrop-filter: blur(6px); padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 8px 40px rgba(2,8,10,0.55);
    }
    .logo{ display:flex; align-items:center; gap:10px; background:var(--accent); color:#041b07; padding:10px 14px; border-radius:12px; font-weight:800; letter-spacing:0.6px; }
    .logo .dot{width:12px;height:12px;border-radius:3px;background:#063;box-shadow:0 0 18px rgba(183,255,76,0.6) inset}
    .search{margin-left:auto; display:flex; gap:8px; align-items:center; padding:8px 12px; border-radius:999px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:var(--lime-1)}
    .search input{background:transparent;border:0;outline:none;color:inherit;width:180px;font-weight:600}
    main{display:grid; grid-template-columns: 1fr 320px; gap:22px; margin-top:18px; align-items:start}
    .feed{max-width:940px;}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.04); padding:9px 12px;border-radius:10px;color:var(--lime-1); cursor:pointer; font-weight:700; transition:transform .12s var(--ease), box-shadow .12s var(--ease)}
    .btn.primary{background:var(--accent); color:#05220b; border:none; box-shadow: 0 10px 30px rgba(142,242,59,0.08)}
    .composer{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px; padding:14px; margin-bottom:14px; border:1px solid rgba(255,255,255,0.03);
      display:flex; gap:12px; align-items:flex-start; box-shadow: 0 6px 20px rgba(2,8,10,0.45);
      transition: transform .18s var(--ease), box-shadow .18s var(--ease);}
    .composer.disabled{opacity:0.55; filter:grayscale(.06); pointer-events:none}
    textarea{flex:1; min-height:68px; resize:vertical; background:transparent; border:1px dashed rgba(255,255,255,0.03); padding:10px; border-radius:10px; color:inherit; font-size:14px; outline:none}
    .post{background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); border-radius:14px; padding:12px; display:flex; gap:12px; border:1px solid rgba(255,255,255,0.03); margin-bottom:12px; align-items:flex-start; box-shadow: 0 10px 30px rgba(2,8,10,0.35);}
    .avatar{width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,#0a1,#012);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071017}
  </style>
</head>
<body>
<header>
  <div class="logo"><div class="dot"></div>Lymo</div>
  <div class="search"><input id="searchInput" placeholder="Search posts..."></div>
</header>

<main>
  <section class="feed">
    <div id="composer" class="composer disabled">
      <div class="avatar">ADM</div>
      <div style="flex:1">
        <input id="postTitle" placeholder="Post title...">
        <input id="postImage" placeholder="Image URL (optional)">
        <textarea id="postBody" placeholder="Write something (admin only)..."></textarea>
        <button id="submitPost" class="btn primary">Post</button>
      </div>
    </div>
    <div id="posts"></div>
  </section>
  <aside>
    <button id="adminToggle" class="btn">Admin</button>
  </aside>
</main>

<!-- APPWRITE SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
<script>
  const client = new Appwrite.Client()
    .setEndpoint("https://nyc.cloud.appwrite.io/v1")
    .setProject("6930516e001b85af6b1e");

  const account = new Appwrite.Account(client);
  const storage = new Appwrite.Storage(client);

  let posts = [];
  let adminPassword = '';
  let adminLogged = false;

  async function loadSecrets() {
    await account.createAnonymousSession();
    const fileBlob = await storage.getFileView("69305285002f8b73e74a", "69305332002860f9ba24");
    const text = await fileBlob.text();
    const secrets = JSON.parse(text);
    window.API_KEY = secrets.apikey;
    window.JSONBIN_ID = secrets.binid;
    loadPosts();
  }

  async function loadPosts() {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${window.JSONBIN_ID}/latest`, {
      headers:{ "X-Master-Key": window.API_KEY }
    });
    const data = await res.json();
    posts = data?.record?.posts || [];
    adminPassword = data?.record?.adminPassword || '';
    renderPosts();
  }

  async function savePosts() {
    await fetch(`https://api.jsonbin.io/v3/b/${window.JSONBIN_ID}`, {
      method:"PUT",
      headers: { "Content-Type":"application/json", "X-Master-Key": window.API_KEY },
      body: JSON.stringify({ posts, adminPassword })
    });
  }

  function renderPosts() {
    const postsEl = document.getElementById('posts');
    postsEl.innerHTML = '';
    posts.forEach(p=>{
      const node = document.createElement('div');
      node.className='post';
      node.innerHTML=`<strong>${p.title}</strong><p>${p.body}</p>`;
      postsEl.appendChild(node);
    });
  }

  document.getElementById('submitPost').addEventListener('click', async ()=>{
    if(!adminLogged){
      const pass = prompt('Enter admin password:');
      if(pass !== adminPassword) return alert('Wrong password');
      adminLogged=true;
      document.getElementById('composer').classList.remove('disabled');
    }
    const title = document.getElementById('postTitle').value || '(no title)';
    const body = document.getElementById('postBody').value || '';
    const newPost = { id:Date.now().toString(), title, body, score:0, created:Date.now() };
    posts.unshift(newPost);
    await savePosts();
    renderPosts();
  });

  document.getElementById('adminToggle').addEventListener('click', ()=>{
    if(adminLogged){ adminLogged=false; document.getElementById('composer').classList.add('disabled'); }
    else { const pass=prompt('Enter admin password:'); if(pass===adminPassword){ adminLogged=true; document.getElementById('composer').classList.remove('disabled'); }}
  });

  loadSecrets();
</script>
</body>
</html>
